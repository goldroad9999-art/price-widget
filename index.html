<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ì˜¤ëŠ˜ì˜ ì‹œì„¸ (VAT ë³„ë„)</title>

<style>
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Apple SD Gothic Neo,Noto Sans KR,sans-serif;
  background:#0f1115;
  color:#f5f5f5;
}

.wrap{
  max-width:720px;   /* ğŸ”¥ ì„¸ë¡œí˜•ì— ë§ê²Œ í­ ì¶•ì†Œ */
  margin:auto;
  padding:20px;
}

h1{
  font-size:18px;
  font-weight:500;
  margin-bottom:8px;
  color:#ffffff;
}

.meta{
  font-size:12px;
  color:#a1a1aa;
  margin-bottom:22px;
  line-height:1.6;
}

.cards{
  display:grid;
  grid-template-columns:1fr; /* âœ… ì„¸ë¡œ 1ì—´ */
  gap:20px;
}

.card{
  background:#171a21;
  border:1px solid #262b36;
  border-radius:18px;
  padding:24px;
  transition:0.2s;
}

.card:hover{
  border-color:#3b82f6;
  box-shadow:0 10px 30px rgba(0,0,0,0.5);
}

.title{
  font-size:17px;
  font-weight:600;
  color:#fff;
}

.sub{
  font-size:12px;
  color:#9ca3af;
  margin-top:4px;
}

.price{
  font-size:24px;
  font-weight:600;
  margin-top:18px;
  letter-spacing:-0.3px;
  color:#fff;
}

.perg{
  margin-top:10px;
  font-size:14px;
  color:#d1d5db;
  font-weight:400;
}

.perg span{
  color:#9ca3af;
}

.delta{
  margin-top:12px;
  font-weight:600;
  font-size:14px;
}

.up{color:#ff5252;}
.down{color:#4dabf7;}

.note{
  margin-top:28px;
  font-size:12px;
  color:#9ca3af;
  line-height:1.6;
}

/* ëª¨ë°”ì¼ ë¯¸ì„¸ ì¡°ì • */
@media(max-width:480px){
  .wrap{padding:16px;}
  .card{padding:18px;}
  .price{font-size:22px;}
}
</style>
</head>

<body>
<div class="wrap">

<h1>ì˜¤ëŠ˜ì˜ ì‹œì„¸ (VAT ë³„ë„)</h1>

<div class="meta">
  <div id="date">ê¸°ì¤€ì¼: -</div>
  <div id="fx">USD/KRW: -</div>
  <div id="update">ì—…ë°ì´íŠ¸: -</div>
</div>

<div class="cards" id="cards"></div>

<div class="note">
â€» ë³¸ ì‹œì„¸ëŠ” êµ­ì œ ì‹œì„¸(USD/oz) ë° í™˜ìœ¨ì„ ê¸°ë°˜ìœ¼ë¡œ ì‚°ì¶œí•œ ê¸°ì¤€ê°€ ì…ë‹ˆë‹¤.<br>
â€» ì‹¤ì œ íŒë§¤/ë§¤ì…ê°€ëŠ” ì—…ì²´ ì •ì±…Â·ìˆ˜ëŸ‰Â·ê°€ê³µë¹„ ë“±ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
</div>

</div>

<script>
const OZ_TO_G = 31.1034768;
const DON = 3.75;

// ì‚¼ì„± ê¸°ì¤€ ë§ì¶¤ ë³´ì •ê³„ìˆ˜
const ADJUST_GOLD = 1.05095;
const ADJUST_SILVER = 1.40270;
const ADJUST_PLAT = 1.07371;

const fmt = n => new Intl.NumberFormat("ko-KR").format(Math.round(n)) + "ì›";
const fmtFx = n => new Intl.NumberFormat("ko-KR", { maximumFractionDigits: 2 }).format(n);

async function fetchFx(){
  const r = await fetch("https://open.er-api.com/v6/latest/USD",{cache:"no-store"});
  const j = await r.json();
  return j.rates.KRW;
}

async function fetchMetal(symbol){
  const r = await fetch(`/.netlify/functions/metal?symbol=${symbol}`,{cache:"no-store"});
  return r.json();
}

function cardHtml(title, perDonPrice, changePct){
  const perG = perDonPrice / DON;
  const up = changePct >= 0;
  const cls = up ? "up" : "down";
  const arrow = up ? "â–²" : "â–¼";

  return `
  <div class="card">
    <div class="title">${title}</div>
    <div class="sub">1ëˆ(3.75g) ê¸°ì¤€</div>

    <div class="price">${fmt(perDonPrice)}</div>

    <div class="perg"><span>1g ê¸°ì¤€ê°€:</span> ${fmt(perG)}</div>

    <div class="delta ${cls}">${arrow} ${Math.abs(changePct).toFixed(2)}%</div>
  </div>`;
}

async function render(){
  const fx = await fetchFx();
  const gold = await fetchMetal("xauusd");
  const silver = await fetchMetal("xagusd");
  const plat = await fetchMetal("xptusd");

  document.getElementById("date").textContent = "ê¸°ì¤€ì¼: " + gold.date;
  document.getElementById("fx").textContent = "USD/KRW: " + fmtFx(fx);
  document.getElementById("update").textContent = "ì—…ë°ì´íŠ¸: " + new Date().toLocaleString("ko-KR");

  const goldPerDon = (gold.close * fx) / OZ_TO_G * DON * ADJUST_GOLD;
  const silverPerDon = (silver.close * fx) / OZ_TO_G * DON * ADJUST_SILVER;
  const platPerDon = (plat.close * fx) / OZ_TO_G * DON * ADJUST_PLAT;

  document.getElementById("cards").innerHTML =
    cardHtml("ìˆœê¸ˆ ì‹œì„¸", goldPerDon, gold.change_pct) +
    cardHtml("ë°±ê¸ˆ ì‹œì„¸", platPerDon, plat.change_pct) +
    cardHtml("ì€ ì‹œì„¸", silverPerDon, silver.change_pct);
}

render();
setInterval(render, 600000);
</script>

</body>
</html>
