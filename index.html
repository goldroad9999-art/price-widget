<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ì˜¤ëŠ˜ì˜ ì‹œì„¸ (ë„ë§¤ê°€, 100% ê¸°ì¤€ê°€)</title>

<style>
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Apple SD Gothic Neo,Noto Sans KR,sans-serif;
  background:#fff;
  color:#111;
}

.wrap{max-width:1100px;margin:auto;padding:20px;}

h1{font-size:24px;font-weight:900;margin-bottom:6px;}

.meta{font-size:13px;color:#555;margin-bottom:20px;line-height:1.6;}

.cards{
  display:grid;
  grid-template-columns:1fr;
  gap:18px;
}

/* ğŸ”¥ ë°ìŠ¤í¬íƒ‘ 3ì¹¸ ì •ë ¬ */
@media(min-width:900px){
  .cards{
    grid-template-columns:repeat(3,1fr);
  }
}

.card{
  border:1px solid #eaeaea;
  border-radius:18px;
  padding:22px;
  transition:0.2s;
}

.card:hover{
  box-shadow:0 10px 25px rgba(0,0,0,0.06);
}

.title{
  font-size:18px;
  font-weight:900;
}

.sub{
  font-size:12px;
  color:#666;
  margin-top:4px;
}

.price{
  font-size:28px;
  font-weight:900;
  margin-top:16px;
}

.delta{
  margin-top:8px;
  font-weight:900;
  font-size:14px;
}

.up{color:#d32f2f;}
.down{color:#1565c0;}

.note{
  margin-top:24px;
  font-size:13px;
  color:#555;
  line-height:1.6;
}
</style>
</head>

<body>
<div class="wrap">

<h1>ì˜¤ëŠ˜ì˜ ì‹œì„¸ (ë„ë§¤ê°€, 100% ê¸°ì¤€ê°€)</h1>

<div class="meta">
  <div id="date">ê¸°ì¤€ì¼: -</div>
  <div id="fx">USD/KRW: -</div>
  <div id="update">ì—…ë°ì´íŠ¸: -</div>
</div>

<div class="cards" id="cards"></div>

<div class="note">
â€» ë³¸ ì‹œì„¸ëŠ” êµ­ì œ ì‹œì„¸(USD/oz) ë° í™˜ìœ¨ì„ ê¸°ë°˜ìœ¼ë¡œ ì‚°ì¶œí•œ ë„ë§¤ê°€(100% ê¸°ì¤€ê°€)ì…ë‹ˆë‹¤.<br>
â€» ì‹¤ì œ íŒë§¤/ë§¤ì…ê°€ëŠ” ì—…ì²´ ì •ì±…Â·ìˆ˜ëŸ‰Â·ê°€ê³µë¹„ ë“±ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
</div>

</div>

<script>
const OZ_TO_G = 31.1034768;
const DON = 3.75;

// ì‚¼ì„± ê¸°ì¤€ ë§ì¶¤ ë³´ì •ê³„ìˆ˜
const ADJUST_GOLD = 1.05095;
const ADJUST_SILVER = 1.40270;
const ADJUST_PLAT = 1.07371;

const fmt = n=>new Intl.NumberFormat("ko-KR").format(Math.round(n))+"ì›";
const fmtFx = n=>new Intl.NumberFormat("ko-KR",{maximumFractionDigits:2}).format(n);

async function fetchFx(){
  const r=await fetch("https://open.er-api.com/v6/latest/USD",{cache:"no-store"});
  const j=await r.json();
  return j.rates.KRW;
}

async function fetchMetal(symbol){
  const r=await fetch(`/.netlify/functions/metal?symbol=${symbol}`,{cache:"no-store"});
  return r.json();
}

function cardHtml(title, price, change){
  const up = change>=0;
  const cls = up?"up":"down";
  const arrow = up?"â–²":"â–¼";

  return `
  <div class="card">
    <div class="title">${title}</div>
    <div class="sub">1ëˆ(3.75g) ê¸°ì¤€</div>
    <div class="price">${fmt(price)}</div>
    <div class="delta ${cls}">${arrow} ${Math.abs(change).toFixed(2)}%</div>
  </div>`;
}

async function render(){
  const fx = await fetchFx();
  const gold = await fetchMetal("xauusd");
  const silver = await fetchMetal("xagusd");
  const plat = await fetchMetal("xptusd");

  document.getElementById("date").textContent="ê¸°ì¤€ì¼: "+gold.date;
  document.getElementById("fx").textContent="USD/KRW: "+fmtFx(fx);
  document.getElementById("update").textContent="ì—…ë°ì´íŠ¸: "+new Date().toLocaleString("ko-KR");

  const goldPrice=(gold.close*fx)/OZ_TO_G*DON*ADJUST_GOLD;
  const silverPrice=(silver.close*fx)/OZ_TO_G*DON*ADJUST_SILVER;
  const platPrice=(plat.close*fx)/OZ_TO_G*DON*ADJUST_PLAT;

  document.getElementById("cards").innerHTML=
    cardHtml("ìˆœê¸ˆ ì‹œì„¸",goldPrice,gold.change_pct)+
    cardHtml("ë°±ê¸ˆ ì‹œì„¸",platPrice,plat.change_pct)+
    cardHtml("ì€ ì‹œì„¸",silverPrice,silver.change_pct);
}

render();
setInterval(render,600000);
</script>

</body>
</html>
