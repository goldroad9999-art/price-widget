<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>오늘의 시세 (VAT 별도)</title>

<style>
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Apple SD Gothic Neo,Noto Sans KR,sans-serif;
  background:#0f1115;
  color:#f5f5f5;
}

.wrap{max-width:1100px;margin:auto;padding:20px;}

h1{
  font-size:22px;
  font-weight:900;
  margin-bottom:6px;
  color:#ffffff;
}

.meta{
  font-size:12px;
  color:#a1a1aa;
  margin-bottom:20px;
  line-height:1.6;
}

.cards{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:10px;
}

/* 모바일 글자 축소 */
@media(max-width:520px){
  .card{ padding:14px; border-radius:14px; }
  .title{ font-size:14px; }
  .sub{ font-size:11px; }
  .price{ font-size:16px; margin-top:10px; }
  .perg{ font-size:12px; }
  .delta{ font-size:12px; }
}

.card{
  background:#171a21;
  border:1px solid #262b36;
  border-radius:18px;
  padding:22px;
  transition:0.2s;
}

.card:hover{
  border-color:#3b82f6;
  box-shadow:0 10px 30px rgba(0,0,0,0.5);
}

.title{
  font-size:17px;
  font-weight:900;
  color:#fff;
}

.sub{
  font-size:12px;
  color:#9ca3af;
  margin-top:4px;
}

.price{
  font-size:22px;
  font-weight:900;
  margin-top:14px;
  letter-spacing:-0.3px;
  color:#fff;
}

.perg{
  margin-top:8px;
  font-size:14px;
  color:#d1d5db;
  font-weight:800;
}

.perg span{
  color:#9ca3af;
}

.delta{
  margin-top:10px;
  font-weight:900;
  font-size:14px;
}

.up{color:#ff5252;}
.down{color:#4dabf7;}

.note{
  margin-top:22px;
  font-size:12px;
  color:#9ca3af;
  line-height:1.6;
}
</style>
</head>

<body>
<div class="wrap">

<h1>오늘의 시세 (VAT 별도)</h1>

<div class="meta">
  <div id="date">기준일: -</div>
  <div id="fx">USD/KRW: -</div>
  <div id="update">업데이트: -</div>
</div>

<div class="cards" id="cards"></div>

<div class="note">
※ 본 시세는 국제 시세(USD/oz) 및 환율을 기반으로 산출한 기준가 입니다.<br>
※ 실제 판매/매입가는 업체 정책·수량·가공비 등에 따라 달라질 수 있습니다.<br>
</div>

</div>

<script>
const OZ_TO_G = 31.1034768;
const DON = 3.75;

// 삼성 기준 맞춤 보정계수
const ADJUST_GOLD = 1.05095;
const ADJUST_SILVER = 1.40270;
const ADJUST_PLAT = 1.07371;

const fmt = n=>new Intl.NumberFormat("ko-KR").format(Math.round(n))+"원";
const fmtFx = n=>new Intl.NumberFormat("ko-KR",{maximumFractionDigits:2}).format(n);

async function fetchFx(){
  const r=await fetch("https://open.er-api.com/v6/latest/USD",{cache:"no-store"});
  const j=await r.json();
  return j.rates.KRW;
}
async function fetchMetal(symbol){
  const r=await fetch(`/.netlify/functions/metal?symbol=${symbol}`,{cache:"no-store"});
  return r.json();
}

function cardHtml(title, perDonPrice, changePct){
  const perG = perDonPrice / DON;

  const up = changePct>=0;
  const cls = up?"up":"down";
  const arrow = up?"▲":"▼";

  return `
  <div class="card">
    <div class="title">${title}</div>
    <div class="sub">1돈(3.75g) 기준</div>

    <div class="price">${fmt(perDonPrice)}</div>

    <div class="perg"><span>1g 기준가:</span> ${fmt(perG)}</div>

    <div class="delta ${cls}">${arrow} ${Math.abs(changePct).toFixed(2)}%</div>
  </div>`;
}

async function render(){
  const fx = await fetchFx();
  const gold = await fetchMetal("xauusd");
  const silver = await fetchMetal("xagusd");
  const plat = await fetchMetal("xptusd");

  document.getElementById("date").textContent="기준일: "+gold.date;
  document.getElementById("fx").textContent="USD/KRW: "+fmtFx(fx);
  document.getElementById("update").textContent="업데이트: "+new Date().toLocaleString("ko-KR");

  const goldPerDon=(gold.close*fx)/OZ_TO_G*DON*ADJUST_GOLD;
  const silverPerDon=(silver.close*fx)/OZ_TO_G*DON*ADJUST_SILVER;
  const platPerDon=(plat.close*fx)/OZ_TO_G*DON*ADJUST_PLAT;

  document.getElementById("cards").innerHTML=
    cardHtml("순금 시세",goldPerDon,gold.change_pct)+
    cardHtml("백금 시세",platPerDon,plat.change_pct)+
    cardHtml("은 시세",silverPerDon,silver.change_pct);
}

render();
setInterval(render,600000);
</script>

</body>
</html>
