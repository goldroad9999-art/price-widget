<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>오늘의 시세 (도매가, 100% 기준가)</title>

<style>
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Apple SD Gothic Neo,Noto Sans KR,sans-serif;
  background:#ffffff;
  color:#111;
}

.wrap{
  max-width:950px;
  margin:auto;
  padding:20px;
}

h1{
  font-size:24px;
  margin-bottom:10px;
  font-weight:900;
}

.meta{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  margin-bottom:18px;
  font-size:13px;
  color:#555;
}

.table{
  border:1px solid #eaeaea;
  border-radius:14px;
  overflow:hidden;
}

.row{
  display:grid;
  grid-template-columns:1.3fr 1fr 1fr;
  padding:18px;
  border-bottom:1px solid #eee;
  align-items:center;
}

.row:last-child{border-bottom:none;}

.head{
  background:#f9f9f9;
  font-weight:900;
}

.name{
  font-size:18px;
  font-weight:900;
}

.sub{
  font-size:12px;
  color:#666;
  margin-top:4px;
}

.price{
  text-align:right;
  font-size:22px;
  font-weight:900;
}

.delta{
  margin-top:6px;
  font-size:12px;
  font-weight:900;
}

.up{color:#d32f2f;}
.down{color:#1565c0;}

.note{
  margin-top:16px;
  font-size:13px;
  color:#555;
  line-height:1.6;
}

@media(max-width:800px){
  .row{grid-template-columns:1fr;}
  .price{text-align:left;margin-top:8px;}
}
</style>
</head>

<body>
<div class="wrap">

<h1>오늘의 시세 (도매가, 100% 기준가)</h1>

<div class="meta">
  <div id="updated">업데이트: -</div>
  <div id="fx">USD/KRW: -</div>
  <div id="based">기준일: -</div>
</div>

<div class="table">
  <div class="row head">
    <div></div>
    <div style="text-align:right;">기준가 (1돈 3.75g)</div>
    <div style="text-align:right;">전일 대비</div>
  </div>
  <div id="rows"></div>
</div>

<div class="note">
※ 본 시세는 국제 시세(USD/oz) 및 환율을 기반으로 산출한 <b>도매가(100% 기준가)</b>입니다.<br/>
※ 실제 판매/매입가는 업체 정책·수량·가공비·프리미엄 등에 따라 달라질 수 있습니다.<br/>
</div>

</div>

<script>
const OZ_TO_G = 31.1034768;
const DON = 3.75;

const fmt = n=>new Intl.NumberFormat("ko-KR").format(Math.round(n))+"원";
const fmtFx = n=>new Intl.NumberFormat("ko-KR",{maximumFractionDigits:2}).format(n);

async function fetchFx(){
  const r=await fetch("https://open.er-api.com/v6/latest/USD",{cache:"no-store"});
  const j=await r.json();
  return j.rates.KRW;
}

async function fetchMetal(symbol){
  const r=await fetch(`/.netlify/functions/metal?symbol=${symbol}`,{cache:"no-store"});
  return r.json();
}

function buildRow(title, perDon, changePct){
  const up = changePct>=0;
  const cls = up?"up":"down";
  const arrow = up?"▲":"▼";

  return `
  <div class="row">
    <div>
      <div class="name">${title}</div>
      <div class="sub">1돈(3.75g)</div>
    </div>
    <div class="price">${fmt(perDon)}</div>
    <div class="delta ${cls}">${arrow} ${Math.abs(changePct).toFixed(2)}%</div>
  </div>`;
}

async function render(){
  const fx = await fetchFx();
  const gold = await fetchMetal("xauusd");
  const silver = await fetchMetal("xagusd");
  const plat = await fetchMetal("xptusd");

  document.getElementById("fx").textContent="USD/KRW: "+fmtFx(fx);
  document.getElementById("updated").textContent="업데이트: "+new Date().toLocaleString("ko-KR");
  document.getElementById("based").textContent="기준일: "+gold.date;

  const goldPerDon=(gold.close*fx)/OZ_TO_G*DON;
  const silverPerDon=(silver.close*fx)/OZ_TO_G*DON;
  const platPerDon=(plat.close*fx)/OZ_TO_G*DON;

  document.getElementById("rows").innerHTML=
    buildRow("순금 시세",goldPerDon,gold.change_pct)+
    buildRow("18K 금 시세",goldPerDon*(18/24),gold.change_pct)+
    buildRow("14K 금 시세",goldPerDon*(14/24),gold.change_pct)+
    buildRow("백금 시세",platPerDon,plat.change_pct)+
    buildRow("은 시세",silverPerDon,silver.change_pct);
}

render();
setInterval(render,600000);
</script>

</body>
</html>
